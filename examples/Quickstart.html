

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quickstart &mdash; pycompwa  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Importing Data" href="DataInput.html" />
    <link rel="prev" title="Examples" href="../examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Main modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-creating-the-amplitude-model">Step 1: Creating the amplitude model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-problem-set-for-this-decay">1.1. Define problem set for this decay</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preparation">1.2. Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#finding-solutions">1.3. Finding solutions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-generate-a-data-sample">Step 2: Generate a data sample</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#writing-and-reading-data-samples">2.1 Writing and reading data samples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-fitting">Step 3: Fitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-visualization">Step 4: Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-fit-fractions">Step 5: Fit Fractions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="DataInput.html">Importing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="ImportanceSampling.html">Importance Sampling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documents.html">Talks and Documents</a></li>
</ul>

            
          
    <a href= "../py-modindex.html">Module Index (API)</a>
    <a href= "../genindex.html">General Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pycompwa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/ComPWA/pycompwa/blob/master/doc/source/examples/Quickstart.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<p>In this example, it is shown how to use ComPWA via the Python interface.
We use the decay <span class="math notranslate nohighlight">\(J/\Psi \rightarrow \gamma \pi^0 \pi^0\)</span> to
illustrate the usual workflow is:</p>
<ol class="arabic simple">
<li><p>Create an amplitude model for the decay.</p></li>
<li><p>Generate a Monte Carlo data sample (hit &amp; miss) using this model.</p></li>
<li><p>Perform a fit on the data sample using the Minuit2 interface.</p></li>
<li><p>Visualize the data and the fit result</p></li>
<li><p>Calculating fit fractions</p></li>
</ol>
<p>In each step, we store the output, so that you can pick up your work at
a later stage (like after performing a fit that takes several hours).</p>
<p>Let’s go!</p>
<p>First, we <code class="docutils literal notranslate"><span class="pre">import</span></code> the necessary components of the expert system:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycompwa.expertsystem.ui.system_control</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">StateTransitionManager</span><span class="p">,</span> <span class="n">InteractionTypes</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pycompwa.expertsystem.amplitude.helicitydecay</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">HelicityAmplitudeGeneratorXML</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Just a little function to print the intermediate states&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pycompwa.expertsystem.topology.graph</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">get_intermediate_state_edges</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;intermediate states:&quot;</span><span class="p">)</span>
    <span class="n">intermediate_states</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">solutions</span><span class="p">:</span>
        <span class="n">edge_id</span> <span class="o">=</span> <span class="n">get_intermediate_state_edges</span><span class="p">(</span><span class="n">g</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">intermediate_states</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edge_props</span><span class="p">[</span><span class="n">edge_id</span><span class="p">][</span><span class="s1">&#39;@Name&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">intermediate_states</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="step-1-creating-the-amplitude-model">
<h2>Step 1: Creating the amplitude model<a class="headerlink" href="#step-1-creating-the-amplitude-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="define-problem-set-for-this-decay">
<h3>1.1. Define problem set for this decay<a class="headerlink" href="#define-problem-set-for-this-decay" title="Permalink to this headline">¶</a></h3>
<p>We first define the boundary conditions of our physics problem, such as
initial state, final state, formalism type, etc. and pass all of that
information to the <code class="docutils literal notranslate"><span class="pre">StateTransitionManager</span></code>. This is the main user
interface class of the ComPWA expert system.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_state</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;J/psi&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
<span class="n">final_state</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="s2">&quot;pi0&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s2">&quot;pi0&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

<span class="n">tbd_manager</span> <span class="o">=</span> <span class="n">StateTransitionManager</span><span class="p">(</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span>
                                     <span class="n">formalism_type</span><span class="o">=</span><span class="s1">&#39;helicity&#39;</span><span class="p">,</span>
                                     <span class="n">topology_building</span><span class="o">=</span><span class="s1">&#39;isobar&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">StateTransitionManager</span></code> (STM) is the main user interface class of
the ComPWA expert system. The boundary conditions of your physics problem
are defined here, such as the initial state, final state, formalism type,
etc…</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prepare_graphs()</span></code> of the STM creates all topology graphs, here using
the isobar model (a tree of two-body decays). It also initializes the
graphs with the initial and final state and a set of conservation laws
at each interaction node.</p></li>
<li><p>By default, all three interaction types (strong, EM, weak) are used in
the preparation stage. However, it is also possible to choose the
allowed interaction types globally via
<code class="docutils literal notranslate"><span class="pre">set_allowed_interaction_types()</span></code>.</p></li>
</ul>
<p>After the preparation step, you can modify the settings returned by
<code class="docutils literal notranslate"><span class="pre">prepare_graphs()</span></code> to your liking. Since this output contains quite a
lot of information, the <cite>expertsystem UI &lt;pycompwa.expertsystem.ui&gt;</cite> aids
in the configuration (especially the STM).</p>
<ul class="simple">
<li><p>A subset of particles that are allow as intermediate states can also be
specified in the STM. Either in the <code class="docutils literal notranslate"><span class="pre">init()</span></code> of the STM or setting
the instance attribute <code class="docutils literal notranslate"><span class="pre">allowed_intermediate_particles</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="preparation">
<h3>1.2. Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h3>
<p>Create all topology graphs using the <strong>isobar model</strong> (tree of two-body
decays) and initialize the graphs with the initial and final state.
Remember that each interaction node defines its own set of conservation
laws.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">StateTransitionManager</span></code> (STM) defines three interaction types:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Interaction</p></th>
<th class="head"><p>Strength</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>strong</p></td>
<td><p><span class="math notranslate nohighlight">\(60\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>electromagnetic (EM)</p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
</tr>
<tr class="row-even"><td><p>weak</p></td>
<td><p><span class="math notranslate nohighlight">\(10^{-4}\)</span></p></td>
</tr>
</tbody>
</table>
<p>By default, all three are used in the preparation stage. The function
<code class="docutils literal notranslate"><span class="pre">prepare_graphs()</span></code> of the STM generates graphs with all possible
combinations of interaction nodes. An overall interaction strength is
assigned to each graph and they are grouped according to this strength.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graph_interaction_settings_groups</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">prepare_graphs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-solutions">
<h3>1.3. Finding solutions<a class="headerlink" href="#finding-solutions" title="Permalink to this headline">¶</a></h3>
<p>If you are happy with the default settings generated by the
<code class="docutils literal notranslate"><span class="pre">StateTransitionManager</span></code>, just start with solving directly!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step takes about 30 sec on a Intel(R) Core(TM) i7-6820HQ CPU
&#64; 2.70GHz running multi-threaded</p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solutions</span><span class="p">,</span> <span class="n">violated_rules</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span>
    <span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; solutions!&quot;</span><span class="p">)</span>
<span class="n">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have a lot of solutions that are actually heavily suppressed
(they involve two weak decays).</p>
<p>In general, you can modify the dictionary returned by
<code class="docutils literal notranslate"><span class="pre">prepare_graphs()</span></code> directly, but the STM also comes with functionality
to globally choose the allowed interaction types
(<code class="docutils literal notranslate"><span class="pre">set_allowed_interaction_types()</span></code>).</p>
<p>So, go ahead and <strong>disable</strong> the <strong>EM</strong> and <strong>weak</strong> interaction!</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tbd_manager</span><span class="o">.</span><span class="n">set_allowed_interaction_types</span><span class="p">(</span>
    <span class="p">[</span><span class="n">InteractionTypes</span><span class="o">.</span><span class="n">Strong</span><span class="p">])</span>
<span class="n">graph_interaction_settings_groups</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">prepare_graphs</span><span class="p">()</span>
<span class="n">solutions</span><span class="p">,</span> <span class="n">violated_rules</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span>
    <span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; solutions!&quot;</span><span class="p">)</span>
<span class="n">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
</pre></div>
</div>
<p>Huh, what happened here? Actually, since a <strong>:math:`gamma` particle</strong>
appears in one of the interaction nodes, the expert system knows that
this node <strong>must involve EM interactions</strong>! Because the node can be an
effective interaction, the weak interaction cannot be excluded, as it
contains only a subset of conservation laws.</p>
<p>Since only the strong interaction was supposed to be used, this results
in a warning and the STM automatically corrects the mistake.</p>
<p>Once the EM interaction is included, this warning disappears. Be aware,
however, that the EM interaction is now available globally. Hence, there
now might be solutions in which both nodes are electromagnetic.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tbd_manager</span><span class="o">.</span><span class="n">set_allowed_interaction_types</span><span class="p">(</span>
    <span class="p">[</span><span class="n">InteractionTypes</span><span class="o">.</span><span class="n">Strong</span><span class="p">,</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">EM</span><span class="p">])</span>
<span class="n">graph_interaction_settings_groups</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">prepare_graphs</span><span class="p">()</span>
<span class="n">solutions</span><span class="p">,</span> <span class="n">violated_rules</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span>
    <span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; solutions!&quot;</span><span class="p">)</span>
<span class="n">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
</pre></div>
</div>
<p>Great! Now we selected only the strongest contributions. Be aware,
though, that there are more effects that can suppress certain decays.
For example branching ratios. In this example <span class="math notranslate nohighlight">\(J/\Psi\)</span> can decay
into <span class="math notranslate nohighlight">\(\pi^0 + \rho^0\)</span> or <span class="math notranslate nohighlight">\(\pi^0 + \omega\)</span>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>decay</p></th>
<th class="head"><p>branching ratio</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="math notranslate nohighlight">
\[\omega \rightarrow \gamma+\pi^0\]</div>
</td>
<td><p>0.0828</p></td>
</tr>
<tr class="row-odd"><td><div class="math notranslate nohighlight">
\[\rho^0 \rightarrow \gamma+\pi^0\]</div>
</td>
<td><p>0.0006</p></td>
</tr>
</tbody>
</table>
<p>Unfortunately, the <span class="math notranslate nohighlight">\(\rho^0\)</span> mainly decays into <span class="math notranslate nohighlight">\(\pi+\pi\)</span>,
not <span class="math notranslate nohighlight">\(\gamma+\pi^0\)</span> and is therefore suppressed. This information
is currently not known to the expert system, but it is possible to hand
the expert system a list of allowed intermediate states:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># particles are found by name comparison,</span>
<span class="c1"># i.e. f2 will find all f2&#39;s and f all f&#39;s independent of their spin</span>
<span class="n">tbd_manager</span><span class="o">.</span><span class="n">allowed_intermediate_particles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>

<span class="n">solutions</span><span class="p">,</span> <span class="n">violated_rules</span> <span class="o">=</span> <span class="n">tbd_manager</span><span class="o">.</span><span class="n">find_solutions</span><span class="p">(</span>
    <span class="n">graph_interaction_settings_groups</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; solutions!&quot;</span><span class="p">)</span>
<span class="n">print_intermediate_states</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have selected all amplitudes that involve <strong>f</strong> states. The
appearing warnings notify the user that the solution space is only
partial. For certain lines in the graph, no suitable particle was found
(since only f states were allowed).</p>
<p>At this point, we are all set to generate some data using this amplitude
model!</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xml_generator</span> <span class="o">=</span> <span class="n">HelicityAmplitudeGeneratorXML</span><span class="p">()</span>
<span class="n">xml_generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
<span class="n">xml_generator</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="s1">&#39;model.xml&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Have a look through the sections of the resulting <code class="docutils literal notranslate"><span class="pre">model.xml</span></code> file to
see what you recognize from the problem set defined so far.</p>
</div>
</div>
<div class="section" id="step-2-generate-a-data-sample">
<h2>Step 2: Generate a data sample<a class="headerlink" href="#step-2-generate-a-data-sample" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will use the amplitude model created above to
generate a data sample via hit &amp; miss Monte Carlo.</p>
<p>Using this amplitude model in the C++ side of ComPWA is simple. The
<code class="docutils literal notranslate"><span class="pre">create_helicity_kinematics()</span></code> helper function builds a <code class="docutils literal notranslate"><span class="pre">Kinematics</span></code>
object following the specifications in the XML model file. The second
argument of this function is a particle list, which can be created with
the <code class="docutils literal notranslate"><span class="pre">read_particles()</span></code> function. The created <code class="docutils literal notranslate"><span class="pre">Kinematics</span></code> object can
be used to generate a phase space sample as well.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">Intensity</span></code> object can be created with the <code class="docutils literal notranslate"><span class="pre">create_intensity()</span></code>
function. Because the Intensities constructed by the Builder are
automatically normalized, you have to pass this function a phase space
sample as an argument. The <code class="docutils literal notranslate"><span class="pre">Kinematics</span></code> instance is then updated with
the needed subsystems of the decay topology during the creation of the
<code class="docutils literal notranslate"><span class="pre">Intensity</span></code> object.</p>
<p>Now all building blocks for generating our data sample are at hand.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pycompwa.ui</span> <span class="k">as</span> <span class="nn">pwa</span>

<span class="n">particle_list</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">read_particles</span><span class="p">(</span><span class="s1">&#39;model.xml&#39;</span><span class="p">)</span>

<span class="n">kinematics</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">create_helicity_kinematics</span><span class="p">(</span><span class="s1">&#39;model.xml&#39;</span><span class="p">,</span> <span class="n">particle_list</span><span class="p">)</span>

<span class="n">generator</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">EvtGenGenerator</span><span class="p">(</span>
    <span class="n">kinematics</span><span class="o">.</span><span class="n">get_particle_state_transition_kinematics_info</span><span class="p">())</span>

<span class="n">random_generator</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">StdUniformRealGenerator</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="n">phsp_sample</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">generate_phsp</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">random_generator</span><span class="p">)</span>

<span class="n">intensity_builder</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">IntensityBuilderXML</span><span class="p">(</span>
    <span class="s1">&#39;model.xml&#39;</span><span class="p">,</span> <span class="n">particle_list</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">phsp_sample</span><span class="p">)</span>

<span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity_builder</span><span class="o">.</span><span class="n">create_intensity</span><span class="p">()</span>

<span class="n">data_sample</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
    <span class="mi">10000</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">random_generator</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="writing-and-reading-data-samples">
<h3>2.1 Writing and reading data samples<a class="headerlink" href="#writing-and-reading-data-samples" title="Permalink to this headline">¶</a></h3>
<p>You may want to write the generated data and phase space samples to
disk, so that you don’t have to perform this step each time you revisit
the fit. ComPWA provides functions for ROOT and ASCII files, that can be
used as follows:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to ROOT</span>
<span class="n">pwa</span><span class="o">.</span><span class="n">write_root_data</span><span class="p">(</span><span class="n">data_sample</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;generated_data.root&#39;</span><span class="p">)</span>
<span class="n">pwa</span><span class="o">.</span><span class="n">write_root_data</span><span class="p">(</span><span class="n">phsp_sample</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;generated_phsp.root&#39;</span><span class="p">)</span>
<span class="c1"># to ASCII</span>
<span class="n">pwa</span><span class="o">.</span><span class="n">write_ascii_data</span><span class="p">(</span><span class="n">data_sample</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;generated_data.dat&#39;</span><span class="p">)</span>
<span class="n">pwa</span><span class="o">.</span><span class="n">write_ascii_data</span><span class="p">(</span><span class="n">phsp_sample</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;generated_phsp.dat&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Importing syntax parallels that:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imported_data</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">read_root_data</span><span class="p">(</span><span class="n">input_file</span><span class="o">=</span><span class="s1">&#39;generated_data.root&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Imported events:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">imported_data</span><span class="o">.</span><span class="n">events</span><span class="p">))</span>
<span class="n">first_event</span> <span class="o">=</span> <span class="n">imported_data</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First event:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_event</span><span class="o">.</span><span class="n">four_momenta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_event</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the ASCII (<code class="docutils literal notranslate"><span class="pre">.dat</span></code>) files contain a header section that
informs you about the final state of the file. You will have to prepend
this section to the file yourself if you want to use a data sample from
another framework.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;generated_data.dat&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">pycompwa.ui</span></code> is the python interface to ComPWA’s C++ modules. Read more
about this <a class="reference internal" href="../modules.html#python-ui"><span class="std std-ref">here</span></a>.</p>
<p>Three important pieces for evaluating an intensity are:</p>
<ul class="simple">
<li><p>The <strong>Intensity</strong> object itself. It was generated previously and stored
within the XML model file.</p></li>
<li><p>A <strong>DataSample</strong> (<code class="docutils literal notranslate"><span class="pre">EventCollection</span></code>). In its raw form a data sample is just an
event-based list of four-momenta with a list of Particle IDs. For the evaluation
of the intensity, the kinematic variables are required as well. Here, the
kinematics class comes into play!</p></li>
<li><p>A <strong>Kinematics</strong> instance. It handles the calculation of the kinematic
variables that are required for the evaluation of the intensity!
For example in the helicity formalism: <span class="math notranslate nohighlight">\((s,\theta,\phi)\)</span>.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="step-3-fitting">
<h2>Step 3: Fitting<a class="headerlink" href="#step-3-fitting" title="Permalink to this headline">¶</a></h2>
<p>An <strong>Intensity</strong> object behaves just like a mathematical function that
takes a <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> as an argument and returns a list of intensities
(real numbers).</p>
<p>To perform a fit, first create an estimator of your choice. An estimator
generally needs:</p>
<ul class="simple">
<li><p>an <code class="docutils literal notranslate"><span class="pre">Intensity</span></code> instance</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> (to which the intensity is fitted)</p></li>
<li><p>optionally: a phase space <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> (which is used to normalize the
<code class="docutils literal notranslate"><span class="pre">Intensity</span></code>)</p></li>
</ul>
<p>A phase space sample can be generated via the <code class="docutils literal notranslate"><span class="pre">generate_phsp()</span></code>
function (see above). Since our <code class="docutils literal notranslate"><span class="pre">Intensity</span></code> is already normalized,
this is not needed here. The data samples can be converted to
<code class="docutils literal notranslate"><span class="pre">DataSet</span></code> using the <code class="docutils literal notranslate"><span class="pre">convert()</span></code> method of <code class="docutils literal notranslate"><span class="pre">Kinematics</span></code>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_set</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">data_sample</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can create an <strong>estimator</strong>. Remember that an estimator indicates
how well a set of model parameters describes a given data set best. In
this example, we use an unbinned log likelihood estimator. The fit
calculations are then performed the calculations with the
<code class="docutils literal notranslate"><span class="pre">FunctionTree</span></code> back-end.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span><span class="p">,</span> <span class="n">initial_parameters</span> <span class="o">=</span> \
    <span class="n">pwa</span><span class="o">.</span><span class="n">create_unbinned_log_likelihood_function_tree_estimator</span><span class="p">(</span>
        <span class="n">intensity</span><span class="p">,</span> <span class="n">data_set</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that you not only receive a estimator object, but also a list of
fit parameters (<code class="docutils literal notranslate"><span class="pre">FitParameterList</span></code>). You use this list of fit
parameters to initialize the optimizer later on. They contain the
following info:</p>
<ul class="simple">
<li><p>the initial values of the parameters</p></li>
<li><p>fix parameters</p></li>
<li><p>define boundaries</p></li>
<li><p>define errors, which can give certain optimizers hints on the step
size</p></li>
</ul>
<p>These fit parameters are initialized with the values stated in the XML
file or with default values if unspecified. But can be changed easily in
Python as well, like fixing certain parameters.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">this parameter is initially not fixed:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
<span class="n">initial_parameters</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">is_fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">initial_parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">is_fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">and now it is fixed:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
<p>To make the fit a bit more interesting, we modify one of the parameters
to a different initial value than the true value.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;before:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
<span class="n">initial_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;after:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
</pre></div>
</div>
<p>Now it’s time to start up a set up a fit. This is quite simple: just
create an optimizer instance of your choice, here Minuit2
(<code class="docutils literal notranslate"><span class="pre">MinuitIF</span></code>), and call its <code class="docutils literal notranslate"><span class="pre">optimize()</span></code> method to start the fitting
process.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The fit (with 14 free parameters) on a Intel(R) Core(TM) i7-6820HQ CPU
&#64; 2.70GHz takes about 15 sec</p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">MinuitIF</span><span class="p">()</span>
<span class="n">fit_result</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">initial_parameters</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_result</span><span class="o">.</span><span class="n">fit_duration_in_seconds</span>
</pre></div>
</div>
<p>Let’s check if the fit parameters are “close to” the true values.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this should be close to 1.0 again:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
      <span class="s2">&quot;+-&quot;</span><span class="p">,</span>
      <span class="n">fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Important</strong>: Note that the intensity instance still needs to be
notified about this optimal set of parameters. They can be applied with
the <code class="docutils literal notranslate"><span class="pre">updateParametersFrom()</span></code> function.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intensity</span><span class="o">.</span><span class="n">updateParametersFrom</span><span class="p">(</span><span class="n">fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, you can store this fit result to disk and pick it up again:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_result</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;fit_result.xml&#39;</span><span class="p">)</span>
<span class="n">imported_fit_result</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;fit_result.xml&#39;</span><span class="p">)</span>
<span class="n">imported_fit_result</span><span class="o">.</span><span class="n">final_parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-visualization">
<h2>Step 4: Visualization<a class="headerlink" href="#step-4-visualization" title="Permalink to this headline">¶</a></h2>
<p>Let’s go ahead and make a Dalitz plot of the data sample and our fit
result. It is easiest to visualize your data with
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">pandas.DataFrame</a>.
This section illustrates how to do this in combination with ComPWA’s
functionality.</p>
<p>Since our model only includes one specific decay topology, the
<code class="docutils literal notranslate"><span class="pre">HelicityKinematics</span></code> class only generates the kinematic variables
needed to evaluate the <code class="docutils literal notranslate"><span class="pre">Intensity</span></code>. In order to make a Dalitz plot,
the kinematic variables from the other subsystems are also needed. They
can be created with <code class="docutils literal notranslate"><span class="pre">create_all_subsystems()</span></code>. The conversion from the
event samples have to be performed again, though:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kinematics</span><span class="o">.</span><span class="n">create_all_subsystems</span><span class="p">()</span>
<span class="n">data_set</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">data_sample</span><span class="p">)</span>
<span class="n">phsp_set</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">phsp_sample</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">data_set</span></code> and <code class="docutils literal notranslate"><span class="pre">phsp_set</span></code> instances are <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> objects can
cannot be understood by pandas. Their data members, however, easily
allow us to make the conversion:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">frame_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_set</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">frame_phsp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">phsp_set</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">frame_data</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_set</span><span class="o">.</span><span class="n">weights</span>
<span class="n">frame_data</span>
</pre></div>
</div>
<p>We added a weights column here as well, though in this case, all data
weights are unity.</p>
<p>To change the number IDs here to the original particle names, you can
extract a mapping from the <code class="docutils literal notranslate"><span class="pre">Kinematics</span></code> object:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>ComPWA ships with a little python plotting module (<code class="docutils literal notranslate"><span class="pre">plotting</span></code>), which
for example helps you to read in ROOT TTree’s and create common plots
(e.g. angular distributions, Dalitz plots). It uses matplotlib as a
backend. You can either hand it data files, or feed it directly with
data.</p>
<p>Please use it, instead of creating your own visualization scripts!</p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transition_info</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">get_particle_state_transition_kinematics_info</span><span class="p">()</span>
<span class="n">id_to_name</span> <span class="o">=</span> <span class="n">transition_info</span><span class="o">.</span><span class="n">get_final_state_id_to_name_mapping</span><span class="p">()</span>
<span class="n">name_to_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">id_to_name</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="k">def</span> <span class="nf">replace_ids</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Just some replace lambda&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">id_to_name</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">title</span>
</pre></div>
</div>
<p>How to visualize the fit? This is where the phase space comes in again.
By attributing an intensity as a weight to each phase space point, we
get a point distribution of the fit model over the space spanned by the
kinematic variables.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intensity_set</span> <span class="o">=</span> <span class="n">intensity</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">phsp_set</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">frame_phsp</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity_set</span>
</pre></div>
</div>
<p>Now you can apply the usual <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> tools to plot the
distributions.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="k">def</span> <span class="nf">plot_1d_comparison</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function for comparing the 1D distributions of fit and data&quot;&quot;&quot;</span>
    <span class="n">frame_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">frame_phsp</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">frame_phsp</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">],</span>
                          <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;normalized intensity&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">replace_ids</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_1d_comparison</span><span class="p">(</span><span class="s1">&#39;theta_2_4_vs_3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_1d_comparison</span><span class="p">(</span><span class="s1">&#39;mSq_(3,4)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<p>Similarly, we can easily create a Dalitz plot:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="k">def</span> <span class="nf">dalitz_plot</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">mass_x</span><span class="p">,</span> <span class="n">mass_y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function to create a Dalitz plot with meaningful axis titles&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">mass_x</span><span class="p">],</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">mass_y</span><span class="p">],</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">frame</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">replace_ids</span><span class="p">(</span><span class="n">mass_x</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">replace_ids</span><span class="p">(</span><span class="n">mass_y</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="n">variable_names</span> <span class="o">=</span> <span class="n">data_set</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">invariant_masses</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variable_names</span>
                    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;mSq_&#39;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;(2,3,4)&#39;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">invariant_masses</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dalitz_plot</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="o">*</span><span class="n">comb</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">dalitz_plot</span><span class="p">(</span><span class="n">frame_phsp</span><span class="p">,</span> <span class="o">*</span><span class="n">comb</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="step-5-fit-fractions">
<h2>Step 5: Fit Fractions<a class="headerlink" href="#step-5-fit-fractions" title="Permalink to this headline">¶</a></h2>
<p>Fit fractions can be calculated using the
<code class="docutils literal notranslate"><span class="pre">fit_fractions_with_propagated_errors()</span></code> function. It requires
amplitude or <code class="docutils literal notranslate"><span class="pre">Intensity</span></code> components that can be extracted from the
<code class="docutils literal notranslate"><span class="pre">IntensityBuilderXML</span></code> instance. A nested list of the component names
has to be specified as well. These are the names specified in the
component XML attributes. If the inner lists contain more than one
component, these components will be added coherently. In this way you
can calculate your own customized fit fractions.</p>
<p>All registered component names can be retrieved via
<code class="docutils literal notranslate"><span class="pre">get_all_component_names()</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intensity_builder</span><span class="o">.</span><span class="n">get_all_component_names</span><span class="p">()</span>
</pre></div>
</div>
<p>Now specify which components you want to get from the builder.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">components</span> <span class="o">=</span> <span class="n">intensity_builder</span><span class="o">.</span><span class="n">create_intensity_components</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;coherent_J/psi_-1_to_gamma_-1+pi0_0+pi0_0&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;J/psi_-1_to_f2(1270)_-1+gamma_-1;f2(1270)_-1_to_pi0_0+pi0_0;&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;J/psi_-1_to_f2(1270)_-2+gamma_-1;f2(1270)_-2_to_pi0_0+pi0_0;&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;J/psi_-1_to_f2(1270)_0+gamma_-1;f2(1270)_0_to_pi0_0+pi0_0;&#39;</span><span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;J/psi_-1_to_f2(1270)_-1+gamma_-1;f2(1270)_-1_to_pi0_0+pi0_0;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;J/psi_-1_to_f2(1270)_-2+gamma_-1;f2(1270)_-2_to_pi0_0+pi0_0;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;J/psi_-1_to_f2(1270)_0+gamma_-1;f2(1270)_0_to_pi0_0+pi0_0;&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">])</span>
</pre></div>
</div>
<p>The last step is to call the actual fit fraction calculation function
<code class="docutils literal notranslate"><span class="pre">fit_fractions_with_propagated_errors()</span></code>. Here, the first required
argument is a list of component pairs. Each pair resembles the nominator
and denominator of a fit fraction.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_fractions</span> <span class="o">=</span> <span class="n">pwa</span><span class="o">.</span><span class="n">fit_fractions_with_propagated_errors</span><span class="p">([</span>
    <span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<span class="p">],</span> <span class="n">phsp_set</span><span class="p">,</span> <span class="n">fit_result</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fit_fractions</span><span class="p">)</span>
</pre></div>
</div>
<p>That’s it. You can check some of the other examples to learn about more
detailed features of ComPWA.</p>
<p>And give us feedback or
<a class="reference external" href="https://compwa.github.io/contribute.html">contribute</a>! ;)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="DataInput.html" class="btn btn-neutral float-right" title="Importing Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ComPWA Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>